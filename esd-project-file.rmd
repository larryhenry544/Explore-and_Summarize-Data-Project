---
title: Exploratory Data Analysis Project
author: Larry Henry Jr.
date: June 8, 2021
output: 
  html_document:
    theme: darkly
    highlight: textmate
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: true
      smooth_scroll: true
---

# Introduction

This project is part of the Udacity's Data Analyst Nanodegree Program. I conducted an Exploratory Data Analysis (EDA) on one of the curated data sets, provided by Udacity, from [Prosper](https://www.prosper.com/plp/about/), which is America’s first [marketplace lending platform](https://www.prosper.com/personal-loans), with over $12 billion in funded loans as of June 2021.

This data set contains 113,937 loans with 81 variables on each loan, including loan amount, borrower rate (or interest rate), current loan status, borrower income, borrower employment status, borrower credit history, and the latest payment information. The dataset contains loans created between 2005-Q4 and 2014-Q1 with a last updated date of 03/11/2014. Here's a link to the [variable definitions](https://docs.google.com/spreadsheets/d/1gDyi_L4UvIrLTEC6Wri5nbaMmkGmLQBk-Yx3z0XDEtI/edit#gid=0) for this dataset.

The main purpose of this project is to summarize the characteristics of variables that can affect the loan status and to get some ideas about the relationships among multiple variables using summary statistics and data visualizations.

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}

# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(ggplot2)
library(gridExtra)
library(GGally)
library(dplyr)
# install.packages('ggpubr')
library(ggpubr)
library(RColorBrewer)
library(knitr)
# install.packages("kableExtra")
library(kableExtra)
library(gridExtra)
library(tidyr)
library(memisc)
library(scales)
library(bitops)
library(RCurl)
# install.packages('psych')
library(psych)
library('corrplot')
library(reshape2)

```

```{r  echo=FALSE, message=FALSE, warning=FALSE, Global_seetings}

# To set global options that apply to every chunk in your file, call knitr::opts_chunk$set in a code chunk. Knitr will treat each option that you pass to knitr::opts_chunk$set as a global default that can be overwritten in individual chunk headers.
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE)

knitr::opts_chunk$set(fig.width = 9,
                      fig.height = 5,
                      fig.path = 'Figs/',
                      fig.align = 'center',
                      tidy = TRUE,
                      echo = FALSE,
                      warning = FALSE,
                      message = FALSE)

# chunk option dev="svg" produces very large vector graphics files
knitr::opts_chunk$set(dev = "svg")

# chunk option dev="png" is the default raster graphics format for HTML output
knitr::opts_chunk$set(dev = "png")

# Global option for table formats
options(knitr.table.format = "simple")

```

## Initial Dataset Exploration

First, the following are the object names of the dataset.

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_the_Data_Display_headers}

# Load the Data
loandata <-
  read.csv(
    '~/My Projects/Udacity/udacity-projects/Project Explore and Summarize Data/csv/prosperLoanData.csv'
  )

loandata %>%
  names()

```

> Prosper Loan Data contains `r nrow(cars)` observations and `r ncol(cars)` variables.

Next, the following is the initial dataframe's structure.

```{r echo=FALSE, message=FALSE, warning=FALSE, data_frame_structure}

str(loandata)

```

Next, I will use a subset of this dataset for performing an analysis. The main purpose of this analysis is to explore the various factors that affect borrowers' rates. The following are the variables I would like to use.

```{r echo=FALSE, message=FALSE, warning=FALSE, Subseting}

# Subset the dataframe
loandata <- subset(loandata,
                   select = c(LoanNumber, LoanOriginalAmount, LoanOriginationDate, LoanOriginationQuarter,
                              Term, LoanStatus, BorrowerRate, LenderYield, ProsperRating..Alpha., 
                              ProsperScore, ListingCategory..numeric., EmploymentStatus, IsBorrowerHomeowner,
                              CreditScoreRangeLower, CreditScoreRangeUpper, InquiriesLast6Months,
                              PublicRecordsLast10Years, IncomeRange, IncomeVerifiable))

# Listing the column names for the subset data
names(loandata)

```

Based on the variables in this dataset, I will transform **Term** and **ListingCategory** columns from 'numeric' to 'factor'. Then, I will transform the **ListingCreationDate** column from 'factor' to 'Date'. The following is the dataset's structure transformed.

```{r echo=FALSE, message=FALSE, warning=FALSE, Transforming_Data}

# Factorizing rating, category, and term as these are the key variables we'd investigate throughout the dataset

# Term: numeric to factors
loandata$Term <- factor(loandata$Term)
levels(loandata$Term) <- c("1 year", "3 years", "5 years")

# ListingCategory: numeric to factors
names(loandata)[names(loandata) == 'ListingCategory..numeric.'] <- 'ListingCategory' 

loandata$ListingCategory <- factor(loandata$ListingCategory)

levels(loandata$ListingCategory) <- c("NA", "Debt Consolidation",
                                      "Home Improvement", "Business",
                                      "Personal Loan", "Student Use",
                                      "Auto", "Other", "Baby&Adoption",
                                      "Boat", "Cosmetic Procedure",
                                      "Engagement Ring", "Green loans",
                                      "Household Expenses", "Large Purchase",
                                      "Medical/Dental", "Motocycle", "RV",
                                      "Taxes", "Vacation", "Wedding Loans")

# Levels starts from "AA", all the way to "HR" and ""
# Rename ProsperRating column
names(loandata)[names(loandata) == 'ProsperRating..Alpha.'] <- 'ProsperRating'

loandata$ProsperRating = factor(loandata$ProsperRating,
                                levels = c("AA", "A", "B", "C", "D", "E", "HR", "NA"))

loandata$ProsperScore = factor(loandata$ProsperScore)

# Display the structure of the subset data
str(loandata)

```

# Univariate Plots Section

In this section, I will perform some preliminary exploration of the transformed dataset. I will run some summaries of the data and create univariate plots to understand the structure of the individual variables in this dataset.

### Categorical Variables

First, let's take a look on various categorical variables starting with Term.

```{r echo=FALSE, message=FALSE, warning=FALSE Term}

# Bar chart: Term
ggplot(data = loandata, aes(x = Term)) +
  geom_bar(color = 'black',
           fill = '#96ADBD',
           width = 0.7) +
  geom_text(
    aes(label = ..count..),
    stat = "count",
    vjust = -0.2,
    colour = "black",
    size = 3.5) +
  ggtitle('Number of Loans by Term') +
  scale_y_continuous(name = 'Loan Count',
                     limits = c(0, 90000),
                     breaks = breaks_width(20000)) +
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.6))


# Proportion table: Term
loandata$Term %>%
  table() %>%
  prop.table()

```
> Above 90% of the loans in this dataset are with term more than 1 year. Most of them is of 3 years.    

```{r echo=FALSE, message=FALSE, warning=FALSE, LoanStatus}

# Horizontal bar chart:  LoanStatus
ggplot(data = loandata, aes(x = LoanStatus)) +
  geom_bar(color = 'black', fill = '#96ADBD') +
  coord_flip() +
  labs(x = ' ', y = 'Loan Count') +
  ylim(0, 60000) +
  geom_text(
    aes(label = ..count..),
    stat = "count",
    hjust = -0.2,
    colour = "black",
    size = 3) +
  ggtitle('Number of Loans by Loan Status') +
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5))

# Proportion table: LoanStatus
loandata$LoanStatus %>%
  table() %>%
  prop.table()

```
> There are four major loan status: "Defaulted", "Current", "Completed", and "Chargedoff."    

```{r echo=FALSE, message=FALSE, warning=FALSE, Prosper_Rating}

# Bar chart: ProsperRating
ggplot(data = subset(loandata, ProsperRating != ""), aes(x = ProsperRating)) +
  geom_bar(color = 'black', fill = '#96ADBD') +
  geom_text(
    aes(label = ..count..),
    stat = "count",
    vjust = -0.2,
    colour = "black",
    size = 3.5) +
  ggtitle('Number of Loans by Prosper Rating') +
  scale_y_continuous(name = 'Loan Count',
                     limits = c(0, 20000),
                     breaks = breaks_width(5000)) +
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5))

# Proportion table: ProsperRating
loandata$ProsperRating %>%
  table() %>%
  prop.table()

```
> The above bar chart shows Prosper's rating distribution. The unrated loans are removed in this plot.  

```{r echo=FALSE, message=FALSE, warning=FALSE, Employment_Status}

# Horizontal bar chart: Employment_Status
ggplot(
  data = loandata, aes(x = EmploymentStatus)) +
  geom_bar(color = 'black', fill = '#96ADBD') +
  coord_flip() +
  labs(x = ' ', y = 'Loan Count') +
  ylim(0, 70000) +
  geom_text(
    aes(label = ..count..),
    stat = "count",
    hjust = -0.2,
    colour = "black",
    size = 3) +
  ggtitle('Number of Loans by Employment Status') +
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5))

# Proportion table : Employment_Status
loandata$EmploymentStatus %>%
  table() %>%
  prop.table()

```
> The majority of Prosper users are either employed or have a full-time job.    

```{r echo=FALSE, message=FALSE, warning=FALSE, Homeowner}

# Pie chart: IsBorrowerHomeowner
ggplot(
  data = loandata, aes(x = '', fill = IsBorrowerHomeowner)) +
  geom_bar() +
  coord_polar(theta = 'y') +
  scale_fill_manual(values=c('#96ADBD', '#425E72'))+
  labs(x = NULL, y = NULL) +
  ggtitle('Number of Borrower Homeowners') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

```

> About half of the users are homeowners.    

```{r echo=FALSE, message=FALSE, warning=FALSE, IncomeRange}

# Horizontal bar chart: IncomeRange
ggplot(
  data = loandata, aes(x = IncomeRange)) + 
  geom_bar(color = 'black', fill = '#96ADBD') +
  coord_flip() +
  labs(x = ' ', y = 'Loan Count') +
  ylim(0, 35000) +
  geom_text(
    aes(label = ..count..),
    stat = "count",
    hjust = -0.2,
    colour = "black",
    size = 3) +
  ggtitle('Number of Loans by Income Range') +
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5))

# Proporation table: IncomeRange
loandata$IncomeRange %>%
  table() %>%
  prop.table()

```
> About 70% of borrowers' income are in the range of $25,000 - $100,000    

```{r echo=FALSE, message=FALSE, warning=FALSE, IncomeVerifiable}

# Pie chart: IncomeVerifiable
ggplot(
  data = loandata, aes(x = '', fill = IncomeVerifiable)) +
  geom_bar() + 
  coord_polar(theta = 'y') +
  scale_fill_manual(values=c('#96ADBD', '#425E72')) +
  labs(x = NULL, y = NULL) +
  ggtitle('Number of Income Verified Borrowers') +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

```

> Most of borrowers have their income verified.    

### Numerical Variables

Next, let's take a look on various numerical variables starting with BorrowerRate.

```{r echo=FALSE, message=FALSE, BorrowerRate_LenderYield}

# Histogram: BorrowerRate
ggplot(
  data = loandata, aes(x=BorrowerRate)) +
  geom_histogram(color = 'black', fill = '#96ADBD') +
  ggtitle('Number of Loans by Borrower Rate') +
  ylab('Loan Count') +
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5))

# Summary: BorrowerRate
summary(loandata$BorrowerRate)

# Histogram: LenderYield
ggplot(
  data = loandata, aes(x=LenderYield)) + 
  geom_histogram(color = 'black', fill = '#96ADBD') +
  ggtitle('Number of Loans by Lender Yield') +  
  ylab('Loan Count') +
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5))

# Summary: LenderYield
summary(loandata$LenderYield)

```
> The BorrowerRate has a right-skewed distribution, with a mean of 19.28%, and median of 18.40%. Similarly, the LenderYield also has a right-skewed distribution, with a mean of 18.27%, and median of 17.30%.

```{r echo=FALSE, message=FALSE, warning=FALSE, CreditScore}

# Histogram (p1) : CreditScoreRangeLower
p1 <- ggplot( data = loandata, aes(x=CreditScoreRangeLower)) +
  geom_histogram(binwidth = 10, color = 'black', fill = '#96ADBD') +
  scale_x_continuous(limits = c(400,900)) +
  ylab('Loan Count')+
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5))

# Histogram (p2) : CreditScoreRangeUpper
p2 <- ggplot(data = loandata, aes(x=CreditScoreRangeUpper)) +
  geom_histogram(binwidth = 10, color = 'black', fill = '#96ADBD') +
  scale_x_continuous(limits = c(400,900)) +
  ylab('Loan Count')+
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5))  

# Plot p1 and p2 in the same column
grid.arrange(
  p1,
  p2,
  ncol = 1,
  top = text_grob(label = 'Number of Loans by Credit Score Range',
                  just = 'right'))

```

> The ranges of credit scores are small compared to the distributions. I will use lower credit score for further analyses. 

```{r echo=FALSE, message=FALSE, warning=FALSE, InquiriesLast6Months}

# Histogram: InquiriesLast6Months
ggplot(data = subset(loandata, is.na(loandata$InquiriesLast6Months)!=TRUE),
       aes(x=InquiriesLast6Months)) +
  geom_histogram(binwidth = 1, color = 'black', fill = '#96ADBD') +
  ggtitle('Number of Loans by Inquiries Last 6 Months') +  
  ylab('Loan Count') +
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5))  

# Check unique values
unique(loandata$InquiriesLast6Months)

```
> The distribution of InquiriesLast6Months is right-skewed and long-tailed. Outliers like 105 and 53 exist.

```{r echo=FALSE, message=FALSE, warning=FALSE, PublicRecordsLast10Years}

# Histogram: PublicRecordsLast10Years
ggplot(data = subset(loandata, is.na(loandata$PublicRecordsLast10Years) != TRUE),
       aes(x = PublicRecordsLast10Years)) +
  geom_histogram(binwidth = 1,
                 color = 'black',
                 fill = '#96ADBD') +
  ggtitle('Number of Loans by Public Records Last 10 Years') +  
  ylab('Loan Count') +
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5))   

# Check unique values
unique(loandata$PublicRecordsLast10Years)

```
> The distribution of PublicRecordsLast10Years is right-skewed and has some outliers.

```{r echo=FALSE, message=FALSE, warning=FALSE, LoanOriginalAmount }

# Histogram: LoanOriginalAmount
ggplot(data = loandata, aes(x = LoanOriginalAmount)) +
  geom_histogram(color = 'black', fill = '#96ADBD') +
  ggtitle('Number of Loans by Loan Original Amount') +  
  ylab('Count') +
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5))    

# Histogram (binwidth adjusted): LoanOriginalAmount
ggplot(data = loandata, aes(x = LoanOriginalAmount)) +
  geom_histogram(binwidth = 200,
                 color = 'black',
                 fill = '#96ADBD') +
  labs(title = 'Number of Loans by Loan Original Amount', caption = '*Binwidth adjusted by 100') +    
  ylab('Loan Count') +
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5))  

```

> LoanOriginalAmount also displays a long-tailed distribution, with some numbers especially higher. The reason why these numbers are more frequent might be because they are the exact numbers (eg. 10,000, 15,000, 20,000) that people tend to choose. 

### Univariate Analysis

#### What is the structure of your dataset?

This is a very large dataset with 113937 records and 81 variables on each loan. For simplicity with the analysis, I use a subset of the original dataset containing the same number of records, but only with 15 variables that I want to explore. The 15 variables are as follows:

**Categorical:** 
* Term
* LoanStatus
* ProsperRating
* ListingCategory
* EmploymentStatus
* IsBorrowerHomeowner
* IncomeRange
* IncomeVerifiable

**Numerical:** 
* BorrowerRate
* LenderYield
* CreditScoreRangeLower
* CreditScoreRangeUpper
* InquiriesLast6Months
* PublicRecordsLast10Years
* LoanOriginalAmount

####  What is/are the main feature(s) of interest in your dataset?

The main features of interest in this dataset are `BorrowerRate` and `ProsperRating`, where `ProsperRating` might be the overall assessment of borrowers performed by Prosper.

####  What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

Features om the dataset that I think will help support my investigation into features of interest are variables regarding borrower's status (i.e.`EmploymentStatus`, `sBorrowerHomeowner`, etc.) as well as those that reveal borrower's past payment history (i.e. `PublicRecords`, `Inquiries`, etc.)

####  Did you create any new variables from existing variables in the dataset?

I factorized a few variables because those variables are either intrinsically categorical or they only have several possible values.

#### Of the features you investigated, were there any unusual distributions? 
#### Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

Of the features you investigated, I observed some unusual distributions in the `LoanOriginalAmount` histogram. The frequencies are higher around `4,000`, `5,000`, `10,000`, `15,000` and so on. I believe these amounts are more common for most borrowers to choose from.

I did not perform any operations on the dataset, as the data was  tidy, Also, I did not perform other transformation other than changing their classes (e.g. numeric -> factor )

# Bivariate Plots Section

```{r echo=FALSE, warning=FALSE, Correlation }

# Correlation matrix of numerical variables
# Text and number sizes are adjusted
ggcorr(
  data = loandata,
  label = TRUE,
  label_size = 1.8,
  size = 2.1,
  hjust = 0.71
) +
  theme_pubr(margin = FALSE,
             border = FALSE,
             legend = 'right')

```

> The correlation matrix shows that there are two strong positive relationships among the features.
The trivial features are `CreditScoreRangeUpper` and `CreditScoreRangeLower`. Next are the `BorrowerRate` and `LenderYield.`

```{r echo=FALSE, message=FALSE, warning=FALSE, BorrowerRateLenderYield }

# Scatter plot: BorrowerRate and Lender Yield
ggplot(data = loandata, aes(x = BorrowerRate, y = LenderYield)) +
  geom_point(fill = I('#96ADBD'), color = I('black'), shape = 21) +
  geom_smooth(method = "lm", color = I('red'))  + # Add regression line 
  theme_pubr()

# Calcuate the correlation coefficient
cor(loandata$BorrowerRate, loandata$LenderYield)

```
> The `BorrowerRate` and the `LenderYield` have a near perfect linear relationship. This is a result from Prosper charging a fixed rate on loans. Therefore, the `BorrowerRate` and the `LenderYield` should have a strong positive relationship.

```{r echo=FALSE, message=FALSE, warning=FALSE, Rating_vs_BorrowerRate }

# Boxplot: ProsperRating and BorrowerRate
ggplot(data = subset(loandata, ProsperRating != ""),
       aes(x = ProsperRating, y = BorrowerRate)) +
  geom_boxplot(color = '#425E72') +
  ggtitle("Borrower Rate by Prosper Rating") +
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5)) 

```

> This boxplot shows that `ProsperRating` does affect borrower rates.

Now, I want to inspect other factors that also have impact on the `BorrowerRate` and the `ProsperRating`. Let's look at the `BorrowerRate` next.

```{r, echo=FALSE, message=FALSE, warning=FALSE, BorrowerRate_vs_Term }

# Boxplot: Term and BorrowerRate
ggplot(data = loandata, aes(x = Term, y = BorrowerRate)) +
  geom_boxplot(color = I('#425E72')) +
  ggtitle("Borrower Rate by Term") +
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5)) 

# Summaries of BorrowerRate by Term
tapply(loandata$BorrowerRate, loandata$Term, summary)

```
> The average rate of the 3-year's is larger than the 1-year's, but is very close to 5-year loan's average. And 5-year loans have smaller range than 3-year loans.

```{r echo=FALSE, message=FALSE, warning=FALSE, OrignalAmount_vs_BorrowerRate}

# Scatter plot: LoanOriginalAmount and BorrowerRate
ggplot(data = loandata, aes(x = LoanOriginalAmount, y = BorrowerRate)) +
  geom_point(alpha = 0.2, color = '#425E72') +
  # geom_point(alpha = 0.2, fill = '#96ADBD', color = 'black', shape = 21) +  
  ggtitle("Borrower Rate by LoanOriginalAmount") +
  theme_pubr() +
  theme(plot.title = element_text(hjust = 0.5)) 

# Calcuate the correlation coefficient
cor(loandata$LoanOriginalAmount, loandata$BorrowerRate)

```
> This graph shows that there is a fairly weak negative relationship between `BorrowerRate` and `OriginalLoanAmount`.

```{r, echo=FALSE, message=FALSE, warning=FALSE, BorrowerRate_vs_ListingCategory}

# Boxplot: ListingCategory and BorrowerRate
ggplot(data = loandata, aes(x = ListingCategory, y = BorrowerRate)) +
  geom_boxplot(color = '#425E72') +
  coord_flip() +
  theme_pubr()

```

> It seems that some categories have lower rates and others have higher rates.

```{r echo=FALSE, IncomeVerificable_and_Homeowner }

# Boxplot: IncomeVerifiable and BorrowerRate
ggplot(data = loandata, aes(x = IncomeVerifiable, y = BorrowerRate)) +
  geom_boxplot(color = '#425E72') +
  theme_pubr()

# Boxplot: IsBorrowerHomeowner and BorrowerRate
ggplot(data = loandata, aes(x = IsBorrowerHomeowner, y = BorrowerRate)) +
  geom_boxplot(color = '#425E72') +
  theme_pubr()

```

> Borrowers with their income verifiable or are homeowners seem to have lower rates, which makes sense.

Finally, let's take a look at how `ProsperRating` affect the aforementioned features.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_Ratings}

# Histogram of Prosper Rating by numbers of loans
ggplot(aes(ProsperRating), data = na.omit(loandata)) +
  geom_histogram(stat = 'count', aes(fill = ProsperRating)) +
  ggtitle('Number of Loans by Prosper Rating') +
  xlab('Rating') +
  ylab('Loan Count') +
  theme_pubr(legend = 'right') +
  theme(plot.title = element_text(hjust = 0.5))  

summary(loandata$ProsperRating)

```
> The majority of loan are non-classify and among those are being rated, “C” rating loan request are the majority.

```{r echo=FALSE, message=FALSE, warning=FALSE, ProsperRating_vs_CreditScore}

# Boxplot: ProsperRating and CreditScoreRangeUpper
ggplot(data = subset(loandata, ProsperRating != ""),
       aes(x = ProsperRating, y = CreditScoreRangeUpper)) +
  geom_boxplot(color = '#425E72') +
  theme_pubr()

```

> A higher credit score by the consumer rating agency also tends to have a higher `ProsperRating`.

```{r echo=FALSE, message=FALSE, warning=FALSE, ProsperRating_vs_IsBorrowerHomeowner }

# Bar charts: ProsperRating colored by IsBorrowerHomeowner
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, fill = IsBorrowerHomeowner)) +
  geom_bar(position = "dodge") +
  scale_fill_discrete() +
  scale_fill_manual(values = c("#96ADBD", "#425E72")) +
  xlab('Rating') +
  ylab('Loan Count') +
  theme_pubr(legend = 'right')

```

> For top `ProsperRating` groups like "AA" and "A", Homeowners are the majority.

```{r echo=FALSE, message=FALSE, warning=FALSE, ProsperRating_vs_IncomeVerifiable }

# Bar charts: ProsperRating colored by IncomeVerifiable
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, fill = IncomeVerifiable)) +
  geom_bar(position = "dodge") +
  scale_fill_discrete() +
  scale_fill_manual(values = c('#96ADBD', '#425E72')) +
  ylab('Loan Count')

```

> This chart shows that it is difficult to get a good rating if a borrower's income cannot be verified. 

## Bivariate Analysis

#### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?
First, the lender yield and borrower rate are strongly related because the fixed rate charged by Prosper. Second, the borrower rate and Prosper rating do vary with borrowers' status.

#### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?
The relationship between list category and the borrower rate is interesting.
In average, cosmetic procedure's rates are relatively higher, whereas boat's rates are lower. 

#### What was the strongest relationship you found?
The strongest relationship I found is the one between the borrower rate and the lender yield, with a correlation coefficient very close to 1.

# Multivariate Plots Section

> **Tip**: Now it's time to put everything together. Based on what you found in
the bivariate plots section, create a few multivariate plots to investigate
more complex interactions between variables. Make sure that the plots that you
create here are justified by the plots you explored in the previous section. If
you plan on creating any mathematical models, this is the section where you
will do that.

```{r echo=FALSE, message=FALSE, warning=FALSE, Jitter_Plot_Homeowner }

# Jitter plot: ProsperRating and BorrowerRate, colored by IsBorrowerHomeowner
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, y = BorrowerRate)) +
  geom_jitter(aes(color = IsBorrowerHomeowner), alpha = 0.4) +
  scale_color_brewer(type = "qual", palette = "Set2")

```

> Using jitter plot, we can visualize the real distribution of the borrrower rate relative to Prosper rating. In addition, I use different colors to indicate whether the individual borrower is a homeowner. This plot shows that most of the "AA" rated borrowers are also homeowners.

```{r echo=FALSE, message=FALSE, warning=FALSE, Colored_Scatter_Plot_OriginalAmount }

# Scatter plot: LoanOriginalAmount and BorrowerRate, colored by ProsperRating
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = LoanOriginalAmount, y = BorrowerRate, color = ProsperRating)) +
  geom_point(alpha = 0.5) +
  scale_color_brewer(type = "qual", palette = "Set2")

```

> In this plot I found several interesting characteristics. First, each rating has its own colored area that is easily recognized, which indicates that Prosper rating is a good predictor for the borrower rate. Second, only highly rated loans ("AA", "A", "B") can have original amount over $30,000, and most lowly rated loans ("E", "HR") are below 10,000.

```{r echo=FALSE, message=FALSE, warning=FALSE, Heat_Map_ListCategory }

# Create the frequency table
subset_table <- subset(loandata, loandata$ProsperRating != "") %>%
  dplyr::select(ProsperRating, ListingCategory, BorrowerRate) %>%
  dplyr::group_by(ProsperRating, ListingCategory) %>%
  summarize(BorrowerRate = mean(BorrowerRate))

head(subset_table)

# Heat map: BorrowerRate based on ProsperRating nad ListingCategory 
ggplot(aes(x = ProsperRating, y = ListingCategory
           , fill = BorrowerRate), data = subset_table) +
  geom_tile(stat = "identity") +
  scale_fill_gradientn(colours = colorRampPalette(c("blue", "grey"))(100))

```

> This plot shows the relative value of the averaged borrower rates of different list categories. 

```{r echo=FALSE, message=FALSE, warning=FALSE, Facet_Boxplot_Category }

# Faceted boxplot: ProsperRating and BorrowerRate by ListingCategory
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, y = BorrowerRate)) +
  geom_boxplot(color = '#425E72') +
  facet_wrap( ~ ListingCategory)

```

> Compared to the previous plot, the boxplots give us more information about the outliers and range of the distribution. But it's more difficult to compare mean values between different categories.

```{r echo=FALSE, message=FALSE, warning=FALSE, Jitter_Plot_Facet_ListCategory }

# Faceted jitter plots: ProsperRating and BorrowerRate by ListingCategory
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, y = BorrowerRate)) +
  geom_jitter(alpha = 0.2, color = '#425E72') +
  facet_wrap(~ ListingCategory)

```

> We can know from this plot that "Boat", "Green loans", "RV" categories have less data points. This explains why they have less outliers in the previous plots.

```{r echo=FALSE, message=FALSE, warning=FALSE, Three_Plots_EmploymentStatus }

# Create the frequency table
table <- subset(loandata, loandata$ProsperRating != "") %>%
    dplyr::select(ProsperRating, EmploymentStatus, BorrowerRate) %>%
    dplyr::group_by(ProsperRating, EmploymentStatus) %>%
    summarize(BorrowerRate = mean(BorrowerRate))

# Heat map: BorrowerRate based on ProsperRating nad EmploymentStatus
ggplot(data = table,
       aes(x = ProsperRating,
           y = EmploymentStatus,
           fill = BorrowerRate)) +
  geom_tile(stat = "identity")+
  scale_fill_gradientn(colours = colorRampPalette(c("navy", "grey"))(100))

# Faceted boxplot: ProsperRating and BorrowerRate by EmploymentStatus
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, y = BorrowerRate)) +
  geom_boxplot(color = '#425E72') +
  facet_wrap( ~ EmploymentStatus)

# Faceted jitter plots: ProsperRating and BorrowerRate by EmploymentStatus
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, y = BorrowerRate)) +
  geom_jitter(alpha = 0.2, color = '#425E72') +
  facet_wrap( ~ EmploymentStatus)

```

> The heat map shows that highly rated "Not employed" borrowers have to pay slight higher rates. The jitter plots shows that even "Not employed", "Retired", or "Part-time" borrowers can get loan with rates lower than 0.2.

```{r echo=FALSE, message=FALSE, warning=FALSE, Jitter_Plots_Term }

# Faceted jitter plots: ProsperRating and BorrowerRate by Term
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, y = BorrowerRate)) +
  geom_jitter(color = '#425E72', alpha = 0.2) +
  facet_wrap( ~ Term)

# Calculate means for each Term
print("mean")
tapply(loandata$BorrowerRate, loandata$Term, mean)

# Calculate standard deviations for each Term
print("standard deviation")
tapply(loandata$BorrowerRate, loandata$Term, sd)

```
> Most loans are either 3-year or 5-year loans, and they have higher borrower rates, and the main difference between 3-year loans and 5-year loans is deivation.

## Multivariate Analysis

#### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?
Term loan is quite a good indicator whether we have a better Lender Yield or not. Also, we see how three variables Lender Yield, Prosper Rating and Debt To Income Ratio come together and how it affect each order. 

#### Were there any interesting or surprising interactions between features?
The criteria for being an AA borrowers seems to be tighten over the year and a there seems to be a fixed borrower rate in criteria HR and AA.

#### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.
No

------

# Final Plots and Summary

> **Tip**: You've done a lot of exploration and have built up an understanding
of the structure of and relationships between the variables in your dataset.
Here, you will select three plots from all of your previous exploration to
present here as a summary of some of your most interesting findings. Make sure
that you have refined your selected plots for good titling, axis labels (with
units), and good aesthetic choices (e.g. color, transparency). After each plot,
make sure you justify why you chose each plot by describing what it shows.

### Plot One
```{r echo=FALSE, message=FALSE, warning=FALSE, warning=FALSE, Plot_One}

# Subplot 1: Boxplot
p3 <- ggplot(data = subset(loandata, ProsperRating != ""),
             aes(x = ProsperRating, y = BorrowerRate)) +
  geom_boxplot(color = '#425E72') +
  labs(
    title = "Boxplot and Jitter Plot",
    subtitle = "Borrower rate by Prosper rating",
    x = "",
    y = "Borrower Rate")

# Subplot 2: Jitter plot
p4 <- ggplot(data = subset(loandata, loandata$ProsperRating != ""),
             aes(x = ProsperRating, y = BorrowerRate)) +
  geom_jitter(alpha = 0.2, color = '#425E72') +
  labs(x = "Prosper Rating",
       y = "Borrower Rate")

# Combine above two plots
grid.arrange(p3, p4, ncol = 1)

```

### Description One
The Prosper rating is an important factor for the borrower rate. High Prosper rating is linked to lower borrower rates.

### Plot Two
```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_Two}

# Colored scatter plot: LoanOriginalAmount, BorrowerRate, ProsperRating
ggplot(
  data = subset(loandata, loandata$ProsperRating != ""),
  aes(x = LoanOriginalAmount, y = BorrowerRate, color = ProsperRating)) +
  geom_point(alpha = 0.5) +
  scale_color_brewer(type = "qual", palette = "Set2") +
  labs(
    title = "Borrower rate by Prosper rating and loan original amount",
    x = "Loan Original Amount($)",
    y = "Borrower Rate",
    color = "Prosper Rating")

```

### Description Two
Only highly rated loans ("AA", "A", "B") can have original amount over $30,000, and most lowly rated loans ("E", "HR") are below 10,000.  Again Prosper rating is an great indicator of the borrower rate. The different colored areas can be easily recognized.

### Plot Three
```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_Three}
# Faceted jitter plots: ProsperRating and BorrowerRate by Term
p5 <- ggplot(data = subset(loandata, loandata$ProsperRating != ""),
             aes(x = ProsperRating, y = BorrowerRate)) +
  geom_jitter(alpha = 0.1, color = '#425E72') +
  facet_wrap( ~ Term) +
  labs(title = "Borrower rate by Prosper rating and term",
       x = "Prosper Rating",
       y = "Borrower Rate")

# Add means and stds to the plot
ggadd(p5, c("mean_sd"), color = "lightgoldenrodyellow")
```

### Description Three
The 3-year loans have higher borrower rates than the 1-year loans in each Prosper rating. The 5-year loans are more concentrated than the 3-year loans and have smaller total range.

------

# Reflection

> **Tip**: Here's the final step! Reflect on the exploration you performed and
the insights you found. What were some of the struggles that you went through?
What went well? What was surprising? Make sure you include an insight into
future work that could be done with the dataset.

> **Tip**: Don't forget to remove this, and the other **Tip** sections before
saving your final work and knitting the final report!

The Prosper loan dataset contains up to 81 variables, which makes it hard to explore at the beginning. If I just randomly explore each variable in term, there would be no end and I probably would forget things along the way. To solve this problem, I decided to only explore the variables related to the borrower rates and the borrowers' statuses. I subeted the dataset into a smaller one with only 15 variables.

In my subset dataset, there were only 7 numerical variables and my main interest was between the borrower rate and the various borrower statuses. Therefore, the majority of the visualizations I created included at least one categorical variable or more. I spent a lot of time researching how to create visualization with one, two, or more categorical variables. The solution is to use boxplots, grouped bar charts, jitter plots, and heat maps for the visualizations.

The result of this analysis shows that Prosper rating and term are two major indicators of the borrower rate. Other borrower statuses also have effects on borrower rate but their effects are either small or are also factors of Prosper rating. I think this analysis would be a good reference for anyone who wants to borrower money from a p2p lending platform. 




I'd almost considering switching to another dataset as the more I'm looking at, the more I get confused and see no significant correlation between the variables. I was suspecting to see few obvious trend and correlation without much investigation but I was wrong. Although there are more than 30 plots in this report. Lots of charts were never appeared here as I did lots of back-of-the-envelope visualisation but wouldn't make any good story. In addition to that, I have to go through each variable one by one, try to understand the meaning as I was not an expert in the financial industry. 

I then categorize these variables into three different players: Prosper company, lenders & borrowers. Only then the variables makes a lot more sense & I'm trying to make assumption a long the way to explore it. At the end of the project, it did give me a sense of understanding for the lending business. 

As I progress through the analysis, I only found Debt to Income ratio is the predictor of Lending Yield and Borrower Rate and the other variables seems not to play that big of a role. To expand to project, we can try to combine various variables and make a predictive model using logistic regression for a go/no-go investment decision or any classification algorigthm would make sense.