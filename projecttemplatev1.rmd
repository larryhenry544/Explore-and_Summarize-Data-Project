Exploratory Data Analysis Project
========================================================
#### by Larry Henry Jr.
#### June 2021
<br>

> **Tip**: You will see quoted sections like this throughout the template to
help you construct your report. Make sure that you remove these notes before
you finish and submit your project!

> **Tip**: One of the requirements of this project is that your code follows
good formatting techniques, including limiting your lines to 80 characters or
less. If you're using RStudio, go into Preferences \> Code \> Display to set up
a margin line to help you keep track of this guideline!



> **Tip**: Before you create any plots, it is a good idea to provide a short
introduction into the dataset that you are planning to explore. Replace this
quoted text with that general information!

## Introduction

This project is part of the Udacity's Data Analyst Nanodegree Program. I conducted an Exploratory Data Analysis (EDA) on one of the curated data sets, provided by Udacity, from [Prosper](https://www.prosper.com/plp/about/), which is Americaâ€™s first [marketplace lending platform](https://www.prosper.com/personal-loans), with over $12 billion in funded loans as of June 2021. 

This data set contains 113,937 loans with 81 variables on each loan, including loan amount, borrower rate (or interest rate), current loan status, borrower income, borrower employment status, borrower credit  history, and the latest payment information. The dataset contain loans created between 2005-Q4 and 2014-Q1 with a last updated date of 03/11/2014. Here's a link to the [variable definitions](https://docs.google.com/spreadsheets/d/1gDyi_L4UvIrLTEC6Wri5nbaMmkGmLQBk-Yx3z0XDEtI/edit#gid=0) for this dataset.

The main purpose of this project is to summarize the characteristics of variables that can affect the loan status and to get some ideas about the  relationships among multiple variables using summary statistics and data visualizations.
<br><br>

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)

library(ggplot2)
library(gridExtra)
library(GGally)
library(dplyr)
# install.packages('ggpubr')
library(ggpubr)
library(RColorBrewer)
library(knitr)
library(gridExtra)
library(tidyr)
library(memisc)
library(scales)
library(bitops)
library(RCurl)
# install.packages('psych')
library(psych)
library('corrplot')

```
## Initial Dataset Exploration

First, we load the Prosper Loan Data and obtain its initial structure and size.

```{r echo=FALSE, Load_the_Data_Display_Counts}
# Load the Data
loandata <- read.csv('~/My Projects/Udacity/udacity-projects/Project Explore and Summarize Data/csv/prosperLoanData.csv')

dim(loandata)
# nrow(loandata)
# ncol(loandata)
names(loandata)
```
<br>
Here's the initial dataframe structure

```{r echo=FALSE, data_frame_structure}
str(loandata)
```

<br>
Next, since I will only use a subset of this dataset for performing an analysis. This main purpose of this analysis is to explore the various factors that affect borrowers' rates. Following are the variables that I'd like to use.

```{r echo=FALSE, Subseting}

# Subset the dataframe
loandata <- subset(loandata,
                   select = c(LoanNumber, LoanOriginalAmount, LoanOriginationDate, LoanOriginationQuarter,
                              Term, LoanStatus, BorrowerRate, LenderYield, ProsperRating..Alpha., 
                              ProsperScore, ListingCategory..numeric., EmploymentStatus, IsBorrowerHomeowner,
                              CreditScoreRangeLower, CreditScoreRangeUpper, InquiriesLast6Months,
                              PublicRecordsLast10Years, IncomeRange, IncomeVerifiable))

# Listing the column names for the subset data
names(loandata)

```

<br>
Based on my observation of the variables in this dataset, there are data that are not in good form.

Therefore, I'll transform Term/ListingCategory columns from 'numeric' to 'factor', and transform ListingCreationDate column from 'factor' to 'Date'. Below is the transformed dataset structure.

```{r echo=FALSE, Transforming_Data}

# Factorizing rating, category, and term as these are the key variables we'd investigate throughout the dataset

# Term: numeric to factors
loandata$Term <- factor(loandata$Term)
levels(loandata$Term)  <- c("1 year", "3 years", "5 years")

# ListingCategory: numeric to factors
names(loandata)[names(loandata) == 'ListingCategory..numeric.'] <- 'ListingCategory' 
loandata$ListingCategory <- factor(loandata$ListingCategory)
levels(loandata$ListingCategory) <- c("NA", "Debt Consolidation",
                                  "Home Improvement", "Business",
                                  "Personal Loan", "Student Use",
                                  "Auto", "Other", "Baby&Adoption",
                                  "Boat", "Cosmetic Procedure",
                                  "Engagement Ring", "Green loans",
                                  "Household Expenses", "Large Purchase",
                                  "Medical/Dental", "Motocycle", "RV",
                                  "Taxes", "Vacation", "Wedding Loans")

# Levels starts from "AA", all the way to "HR" and ""
# Rename ProsperRating column
names(loandata)[names(loandata) == 'ProsperRating..Alpha.'] <- 'ProsperRating'

loandata$ProsperRating = factor(loandata$ProsperRating,
                                 levels = c("AA","A","B","C","D","E","HR","NA"))
# loandata$ProsperRating <-factor(loandata$ProsperRating..,
#                         levels = c('AA', 'A', 'B', 'C', 'D', 'E', 'HR', 'NA'))
loandata$ProsperScore = factor(loandata$ProsperScore)

# Display the structure of the subset data
str(loandata)

```

<br><br>

# Univariate Plots Section

> **Tip**: In this section, you should perform some preliminary exploration of
your dataset. Run some summaries of the data and create univariate plots to
understand the structure of the individual variables in your dataset. Don't
forget to add a comment after each plot or closely-related group of plots!
There should be multiple code chunks and text sections; the first one below is
just to help you get started.

```{r echo=FALSE, Univariate_Plots_Ratings}
# Histogram of Prosper Rating by numbers of loans
ggplot(aes(ProsperRating), data = na.omit(loandata)) +
  geom_histogram(stat='count', aes(fill = ProsperRating)) +
  ggtitle('Numbers of Loans by Prosper Rating') +
  xlab('Rating') +
  ylab('Number of Loans')
summary(loandata$ProsperRating)
```

> **Tip**: Make sure that you leave a blank line between the start / end of
each code block and the end / start of your Markdown text so that it is
formatted nicely in the knitted text. Note as well that text on consecutive
lines is treated as a single space. Make sure you have a blank line between
your paragraphs so that they too are formatted for easy readability.


### Categorical Variables

First, let's take a look on various categorical variables starting with Term.

```{r echo=FALSE, Term}

# Bar chart: Term
ggplot(data = loandata, aes(x = Term)) +
  geom_bar(color = 'black', fill = '#007EE5') +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.6)) +
  ylab('Count')

# Proportion table: Term
prop.table(table(loandata$Term))

```

> Above 90% of the loans in this dataset are with term more than 1 year. Most of them is of 3 years.    

<br><br>

```{r echo=FALSE, LoanStatus}

# Horizontal bar chart:  LoanStatus
ggplot(data = loandata, aes(x = LoanStatus)) +
  geom_bar(color = 'black', fill = '#007EE5') +
  coord_flip() +
  ylab('Count')

# Proportion table: LoanStatus
prop.table(table(loandata$LoanStatus))

```

> There are four major loan status: "Defaulted", "Current", "Completed", and "Chargedoff."    

<br><br>

```{r echo=FALSE, Prosper_Rating}

# Bar chart: ProsperRating
ggplot(data = subset(loandata, ProsperRating != ""), aes(x = ProsperRating)) +
  geom_bar(color = 'black', fill = '#007EE5') +
  ylab('Count')

# Proportion table: ProsperRating
prop.table(table(loandata$ProsperRating))


```

> The above bar chart shows Prosper's rating distribution. The unrated loans are removed in this plot.  

<br><br>

```{r echo=FALSE, Employment_Status}

# Horizontal bar chart: Employment_Status
ggplot(
  data = loandata, aes(x = EmploymentStatus)) +
  geom_bar(color = 'black', fill = '#007EE5') +
  coord_flip() +
  ylab('Count')

# Proportion table : Employment_Status
prop.table(table(loandata$EmploymentStatus))

```

> The majority of Prosper users are either employed or have a full-time job.    

<br><br>

```{r echo=FALSE, Homeowner}

# Pie chart: IsBorrowerHomeowner
ggplot(
  data = loandata, aes(x = "", fill = IsBorrowerHomeowner)) +
  geom_bar() +
  coord_polar(theta = "y") +
  scale_fill_manual(values=c("#dddddd", "#888888"))

```

> About half of the users are homeowners.    

<br><br>

```{r echo=FALSE, IncomeRange}

# Horizontal bar chart: IncomeRange
ggplot(
  data = loandata, aes(x = IncomeRange)) + 
  geom_bar(color = 'black', fill = '#007EE5') + 
  coord_flip()

# Proporation table: IncomeRange
prop.table(table(loandata$IncomeRange))

```
> About 70% of borrowers' income are in the range of $25,000 - $100,000    

<br><br>

```{r echo=FALSE, IncomeVerifiable}

# Pie chart: IncomeVerifiable
ggplot(
  data = loandata, aes(x = "", fill = IncomeVerifiable)) +
  geom_bar() + 
  coord_polar(theta = "y") +
  scale_fill_manual(values=c("#dddddd", "#888888"))

```

> Most of borrowers have their income verified.    

<br><br>

### Numerical Variables

Next, let's take a look on various numerical variables starting with BorrowerRate.

```{r echo=FALSE, message=FALSE, BorrowerRate_LenderYield}

# Histogram: BorrowerRate
ggplot(
  data = loandata, aes(x=BorrowerRate)) +
  geom_histogram(color = 'black', fill = '#007EE5') +
  ylab('Count')

# Summary: BorrowerRate
summary(loandata$BorrowerRate)

# Histogram: LenderYield
ggplot(
  data = loandata, aes(x=LenderYield)) + 
  geom_histogram(color = 'black', fill = '#007EE5') +
  ylab('Count')

# Summary: LenderYield
summary(loandata$LenderYield)

```
> The BorrowerRate has a right-skewed distribution, with a mean of 19.28%, and median of 18.40%. Similarly, the LenderYield also has a right-skewed distribution, with a mean of 18.27%, and median of 17.30%.

<br><br>

```{r echo=FALSE, message=FALSE, warning=FALSE, CreditScore}

# Histogram (p1) : CreditScoreRangeLower
p1 <- ggplot( data = loandata, aes(x=CreditScoreRangeLower)) +
  geom_histogram(binwidth = 10, color = 'black', fill = '#007EE5') +
  scale_x_continuous(limits = c(400,900)) +
  ylab('Count')

# Histogram (p1) : CreditScoreRangeLower
p2 <- ggplot(data = loandata, aes(x=CreditScoreRangeUpper)) +
  geom_histogram(binwidth = 10, color = 'black', fill = '#007EE5') +
  scale_x_continuous(limits = c(400,900)) +
  ylab('Count')

# Plot p1 and p2 in the same column
grid.arrange(p1, p2, ncol=1)

```

> The ranges of credit scores are small compared to the distributions. I will use lower credit score for further analyses. 

<br><br>

```{r echo=FALSE, InquiriesLast6Months}

# Histogram: InquiriesLast6Months
ggplot(data = subset(loandata, is.na(loandata$InquiriesLast6Months)!=TRUE),
       aes(x=InquiriesLast6Months)) +
  geom_histogram(binwidth = 1, color = 'black', fill = '#007EE5')

# Check unique values
unique(loandata$InquiriesLast6Months)

```
> The distribution of InquiriesLast6Months is right-skewed and long-tailed. Outliers like 105 and 53 exist.

<br><br>

```{r echo=FALSE, PublicRecordsLast10Years}

# Histogram: PublicRecordsLast10Years
ggplot(data = subset(loandata, is.na(loandata$PublicRecordsLast10Years) != TRUE),
       aes(x = PublicRecordsLast10Years)) +
  geom_histogram(binwidth = 1,
                 color = 'black',
                 fill = '#007EE5')

# Check unique values
unique(loandata$PublicRecordsLast10Years)

```

> The distribution of PublicRecordsLast10Years is right-skewed and has some outliers.

<br><br>

```{r echo=FALSE, message=FALSE, warning=FALSE, LoanOriginalAmount }

# Histogram: LoanOriginalAmount
ggplot(data = loandata, aes(x = LoanOriginalAmount)) +
  geom_histogram(color = 'black', fill = '#007EE5')

# Histogram (binwidth adjusted): LoanOriginalAmount
ggplot(data = loandata, aes(x = LoanOriginalAmount)) +
  geom_histogram(binwidth = 200,
                 color = 'black',
                 fill = '#007EE5')

```

> LoanOriginalAmount also displays a long-tailed distribution, with some numbers especially higher. The reason why these numbers are more frequent might be because they are the exact numbers (eg. 10,000, 15,000, 20,000) that people tend to choose. 

<br><br>

# Univariate Analysis

> **Tip**: Now that you've completed your univariate explorations, it's time to
reflect on and summarize what you've found. Use the questions below to help you
gather your observations and add your own if you have other thoughts!

### What is the structure of your dataset?

This is a very large dataset with 113937 loan records and 81 features on each loan. For simplicity with the analysis, I only use a subset of the origianl dataset. The subset has same number of records (113937), but only with 15 features that I want to explore. Those features (after transformation) are as follow:

Categorical: Term, LoanStatus, ProsperRating, ListingCategory, EmploymentStatus, IsBorrowerHomeowner, IncomeRange, IncomeVerifiable

Numerical: BorrowerRate, LenderYield, CreditScoreRangeLower, CreditScoreRangeUpper, InquiriesLast6Months, PublicRecordsLast10Years, LoanOriginalAmount

<br>

### What is/are the main feature(s) of interest in your dataset?

The main features of interest in this dataset are BorrowerRate and ProsperRating, where ProsperRating might be the overall assessments of the borrowers performed by Prosper.

<br>

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

The features regarding borrowers' status (EmploymentStatus, IsBorrowerHomeowner, etc.) and those that reveals borrowers' past payment history (PublicRecords, Inquiries, etc.)

<br>

### Did you create any new variables from existing variables in the dataset?

No, I didn't create any new variables. I only convert some variables from numeric to factor. Thoses variables are either instrinsically  categorical or they have only serveral possible values.

<br>

### Of the features you investigated, were there any unusual distributions? 
### Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

I observed some unusal distributions in the histogram of LoanOriginalAmount. The frequencies are higher around 4,000, 5,000, 10,000, 15,000 and so on. I think that's because these numbers are just easy to pick for most borrowers.

The dataset is tidy and I did not perform other transformation other than changing their classes (ex. numeric -> factor )

<br><br>

# Bivariate Plots Section

> **Tip**: Based on what you saw in the univariate plots, what relationships
between variables might be interesting to look at in this section? Don't limit
yourself to relationships between a main output feature and one of the
supporting variables. Try to look at relationships between supporting variables
as well.

```{r echo=FALSE, warning=FALSE, Correlation }

# Correlation matrix of numerical variables
# Text and number sizes are adjusted
ggcorr(
  data = loandata,
  label = TRUE,
  label_size = 2,
  size = 1.4,
  hjust = 0.7
)

```

> The correlation matrix shows that there are two strong positive relationships among the features.
The first one is the trivial one: credit score upper range and lower range. And the second one is the borrower rate and the lender yield.

<br><br>

```{r echo=FALSE, BorrowerRateLenderYield }

# Scatter plot: BorrowerRate and Lender Yield
ggplot(data = loandata, aes(x = BorrowerRate, y = LenderYield)) +
  geom_point() +
  geom_smooth(method = "lm")  # Add regression line 

# Calcuate the correlation coefficient
cor(loandata$BorrowerRate, loandata$LenderYield)

```

> The borrower rate and the lender yield have nearly perfect linear relationship. This is because Prosper charges a fixed rate on loans so the borrower rate and the lender yield should be strongly positively related.

<br><br>

```{r echo=FALSE, Rating_vs_BorrowerRate }

# Boxplot: ProsperRating and BorrowerRate
ggplot(data = subset(loandata, ProsperRating != ""),
       aes(x = ProsperRating, y = BorrowerRate)) +
  geom_boxplot()

```

>This plot shows that Prosper ratings do affect borrowers' rates.

<br><br>

Next, I want to inspect other factors that also have impact on the borrower rate and the Prosper rating.
I'll start with the borrower rate.

```{r, echo=FALSE, BorrowerRate_vs_Term }

# Boxplot: Term and BorrowerRate
ggplot(data = loandata, aes(x = Term, y = BorrowerRate)) +
  geom_boxplot()

# Summaries of BorrowerRate by Term
tapply(loandata$BorrowerRate, loandata$Term, summary)

```

> The average rate of the 3-year's is larger than the 1-year's, but is very close to 5-year loan's average. And 5-year loans have smaller range than 3-year loans.

<br><br>

```{r echo=FALSE, OrignalAmount_vs_BorrowerRate}

# Scatter plot: LoanOriginalAmount and BorrowerRate
ggplot(data = loandata, aes(x = LoanOriginalAmount, y = BorrowerRate)) +
  geom_point(alpha = 0.1)

# Calcuate the correlation coefficient
cor(loandata$LoanOriginalAmount, loandata$BorrowerRate)

```

> There exists a fairly weak negative relationship between the borrower rate and the original loan amount.

<br><br>

```{r, echo=FALSE, BorrowerRate_vs_ListingCategory}

# Boxplot: ListingCategory and BorrowerRate
ggplot(data = loandata, aes(x = ListingCategory, y = BorrowerRate)) +
  geom_boxplot() +
  coord_flip()

```

> It seems that some categories have lower rates and others have higher rates.

<br><br>

```{r echo=FALSE, IncomeVerificable_and_Homeowner }

# Boxplot: IncomeVerifiable and BorrowerRate
ggplot(data = loandata, aes(x = IncomeVerifiable, y = BorrowerRate)) +
  geom_boxplot()

# Boxplot: IsBorrowerHomeowner and BorrowerRate
ggplot(data = loandata, aes(x = IsBorrowerHomeowner, y = BorrowerRate)) +
  geom_boxplot()

```

> Borrowers with their income verifiable or are homeowners seem to have lower rates, which makes sense.

<br><br>

Finally in this section, I want to what affect Prosper rating.

```{r echo=FALSE, ProsperRating_vs_CreditScore}

# Boxplot: ProsperRating and CreditScoreRangeUpper
ggplot(data = subset(loandata, ProsperRating != ""),
       aes(x = ProsperRating, y = CreditScoreRangeUpper)) +
  geom_boxplot()

```

> A higher credit score by the consumer rating agency also tends to have a higher Prosper rating.

<br><br>

```{r echo=FALSE, ProsperRating_vs_IsBorrowerHomeowner }

# Bar charts: ProsperRating colored by IsBorrowerHomeowner
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, fill = IsBorrowerHomeowner)) +
  geom_bar(position = "dodge") +
  scale_fill_discrete() +
  scale_fill_manual(values = c("#888888", "#099DD9")) +
  ylab('Count')

```

> For top ProsperRating groups like "AA" and "A", Homeowners are the majority.

<br><br>

```{r echo=FALSE, ProsperRating_vs_IncomeVerifiable }

# Bar charts: ProsperRating colored by IncomeVerifiable
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, fill = IncomeVerifiable)) +
  geom_bar(position = "dodge") +
  scale_fill_discrete() +
  scale_fill_manual(values = c("#888888", "#099DD9")) +
  ylab('Count')

```

> It seems very hard to get top rating when you don't have your income verfied.

<br><br>

# Bivariate Analysis

> **Tip**: As before, summarize what you found in your bivariate explorations
here. Use the questions below to guide your discussion.

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

First, the lender yield and borrower rate are strongly related because the fixed rate charged by Prosper. Second, the borrower rate and Prosper rating do vary with borrowers' status.

<br>

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

The relationship between list category and the borrower rate is interesting.
In average, cosmetic procedure's rates are relatively higher, whereas boat's rates are lower. 

<br>

### What was the strongest relationship you found?

The strongest relationship I found is the one between the borrower rate and the lender yield, with a correlation coefficient very close to 1.

<br><br>

# Multivariate Plots Section

> **Tip**: Now it's time to put everything together. Based on what you found in
the bivariate plots section, create a few multivariate plots to investigate
more complex interactions between variables. Make sure that the plots that you
create here are justified by the plots you explored in the previous section. If
you plan on creating any mathematical models, this is the section where you
will do that.

```{r echo=FALSE, Jitter_Plot_Homeowner }

# Jitter plot: ProsperRating and BorrowerRate, colored by IsBorrowerHomeowner
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, y = BorrowerRate)) +
  geom_jitter(aes(color = IsBorrowerHomeowner), alpha = 0.4) +
  scale_color_brewer(type = "qual", palette = "Set2")

```

> Using jitter plot, we can visualize the real distribution of the borrrower rate relative to Prosper rating. In addition, I use different colors to indicate whether the individual borrower is a homeowner. This plot shows that most of the "AA" rated borrowers are also homeowners.

<br><br>

```{r echo=FALSE, Colored_Scatter_Plot_OriginalAmount }

# Scatter plot: LoanOriginalAmount and BorrowerRate, colored by ProsperRating
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = LoanOriginalAmount, y = BorrowerRate, color = ProsperRating)) +
  geom_point(alpha = 0.5) +
  scale_color_brewer(type = "qual", palette = "Set2")

```
>In this plot I found several interesting characteristics. First, each rating has its own colored area that is easily recognized, which indicates that Prosper rating is a good predictor for the borrower rate. Second, only highly rated loans ("AA", "A", "B") can have original amount over $30,000, and most lowly rated loans ("E", "HR") are below 10,000.

<br><br>

```{r echo=FALSE, Heat_Map_ListCategory }
library(reshape2)
# Create the frequency table
subset_table <- subset(loandata, loandata$ProsperRating != "") %>%
  dplyr::select(ProsperRating, ListingCategory, BorrowerRate) %>%
  dplyr::group_by(ProsperRating, ListingCategory) %>%
  plyr::summarize(BorrowerRate = mean(BorrowerRate))


# Heat map: BorrowerRate based on ProsperRating nad ListingCategory 
ggplot(aes(x = ProsperRating, y = ListingCategory
           , fill = BorrowerRate), data = subset_table) +
  geom_tile(inherit.aes = FALSE)


# ggplot(aes(y = gene, x = case, fill = value),
#   data = nci.long.samp) +
#   geom_tile() +
#   scale_fill_gradientn(colours = colorRampPalette(c("blue", "red"))(100))

```

> This plot shows the relative value of the averaged borrower rates of different list categories. 

<br><br>

```{r echo=FALSE, Facet_Boxplot_Category }

# Faceted boxplot: ProsperRating and BorrowerRate by ListingCategory
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, y = BorrowerRate)) +
  geom_boxplot() +
  facet_wrap( ~ ListingCategory)

```

> Compared to the previous plot, the boxplots give us more information about the outliers and range of the distribution. But it's more difficult to compare mean values between different categories.

<br><br>

```{r echo=FALSE, Jitter_Plot_Facet_ListCategory }

# Faceted jitter plots: ProsperRating and BorrowerRate by ListingCategory
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, y = BorrowerRate)) +
  geom_jitter(alpha = 0.2) +
  facet_wrap( ~ ListingCategory)

```

> We can know from this plot that "Boat", "Green loans", "RV" categories have less data points. This explains why thet have less outliers in the previous plots.

<br><br>

```{r echo=FALSE, Three_Plots_EmploymentStatus }

# Create the frequency table
table <- subset(loandata, loandata$ProsperRating != "") %>%
    select(ProsperRating, EmploymentStatus, BorrowerRate) %>%
    group_by(ProsperRating, EmploymentStatus) %>%
    summarize(BorrowerRate = mean(BorrowerRate))

# Heat map: BorrowerRate based on ProsperRating nad EmploymentStatus
ggplot(data = table,
       aes(x = ProsperRating,
           y = EmploymentStatus,
           fill = BorrowerRate)) +
  geom_tile(stat = "identity")

# Faceted boxplot: ProsperRating and BorrowerRate by EmploymentStatus
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, y = BorrowerRate)) +
  geom_boxplot() +
  facet_wrap( ~ EmploymentStatus)

# Faceted jitter plots: ProsperRating and BorrowerRate by EmploymentStatus
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, y = BorrowerRate)) +
  geom_jitter(alpha = 0.2) +
  facet_wrap( ~ EmploymentStatus)

```

> The heat map shows that highly rated "Not employed" borrowers have to pay slight higher rates. The jitter plots shows that even "Not employed", "Retired", or "Part-time" borrowers can get loan with rates lower than 0.2.

<br><br>

```{r echo=FALSE, Jitter_Plots_Term }

# Faceted jitter plots: ProsperRating and BorrowerRate by Term
ggplot(data = subset(loandata, loandata$ProsperRating != ""),
       aes(x = ProsperRating, y = BorrowerRate)) +
  geom_jitter(alpha = 0.2) +
  facet_wrap( ~ Term)

# Calculate means for each Term
print("mean")
tapply(loandata$BorrowerRate, loandata$Term, mean)

# Calculate standard deviations for each Term
print("standard deviation")
tapply(loandata$BorrowerRate, loandata$Term, sd)

```

> Most loans are either 3-year or 5-year loans, and they have higher borrower rates, and the main difference between 3-year loans and 5-year loans is deivation.

<br><br>

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

> **Tip**: You've done a lot of exploration and have built up an understanding
of the structure of and relationships between the variables in your dataset.
Here, you will select three plots from all of your previous exploration to
present here as a summary of some of your most interesting findings. Make sure
that you have refined your selected plots for good titling, axis labels (with
units), and good aesthetic choices (e.g. color, transparency). After each plot,
make sure you justify why you chose each plot by describing what it shows.

### Plot One
```{r echo=FALSE, warning=FALSE, Plot_One}

# Subplot 1: Boxplot
p3 <- ggplot(data = subset(loandata, ProsperRating != ""),
             aes(x = ProsperRating, y = BorrowerRate)) +
  geom_boxplot() +
  labs(
    title = "Boxplot and Jitter Plot",
    subtitle = "Borrower rate by Prosper rating",
    x = "",
    y = "Borrower Rate"
  )

# Subplot 2: Jitter plot
p4 <- ggplot(data = subset(loandata, loandata$ProsperRating != ""),
             aes(x = ProsperRating, y = BorrowerRate)) +
  geom_jitter(alpha = 0.2) +
  labs(x = "Prosper Rating",
       y = "Borrower Rate")

# Combine above two plots
grid.arrange(p3, p4, ncol = 1)

```

### Description One

The Prosper rating is an important factor for the borrower rate. High Prosper rating is linked to lower borrower rates.

<br>

### Plot Two
```{r echo=FALSE, Plot_Two}

# Colored scatter plot: LoanOriginalAmount, BorrowerRate, ProsperRating
ggplot(
  data = subset(loandata, loandata$ProsperRating != ""),
  aes(x = LoanOriginalAmount, y = BorrowerRate, color = ProsperRating)) +
  geom_point(alpha = 0.5) +
  scale_color_brewer(type = "qual", palette = "Set2") +
  labs(
    title = "Borrower rate by Prosper rating and loan original amount",
    x = "Loan Original Amount($)",
    y = "Borrower Rate",
    color = "Prosper Rating"
  )

```

### Description Two

Only highly rated loans ("AA", "A", "B") can have original amount over $30,000, and most lowly rated loans ("E", "HR") are below 10,000.  Again Prosper rating is an great indicator of the borrower rate. The different colored areas can be easily recognized.

<br>

### Plot Three
```{r echo=FALSE, Plot_Three}

# Faceted jitter plots: ProsperRating and BorrowerRate by Term
p5 <- ggplot(data = subset(loandata, loandata$ProsperRating != ""),
             aes(x = ProsperRating, y = BorrowerRate)) +
  geom_jitter(alpha = 0.1) +
  facet_wrap( ~ Term) +
  labs(title = "Borrower rate by Prosper rating and term",
       x = "Prosper Rating",
       y = "Borrower Rate")

# Add means and stds to the plot
ggadd(p5, c("mean_sd"), color = "lightgoldenrodyellow")

```

### Description Three

The 3-year loans have higher borrower rates than the 1-year loans in each Prosper rating. The 5-year loans are more concentrated than the 3-year loans and have smaller total range.

<br><br>

------

# Reflection

> **Tip**: Here's the final step! Reflect on the exploration you performed and
the insights you found. What were some of the struggles that you went through?
What went well? What was surprising? Make sure you include an insight into
future work that could be done with the dataset.

> **Tip**: Don't forget to remove this, and the other **Tip** sections before
saving your final work and knitting the final report!

The Prosper loan dataset contains up to 81 variables, which makes it hard to explore at the beginning. If I just randomly explore each variable in term, there would be no end and I probably would forget things along the way. To solve this problem, I decided to only explore the variables related to the borrower rates and the borrowers' statuses. I subeted the dataset into a smaller one with only 15 variables.

In my subset dataset, there were only 7 numerical variables and my main interest was between the borrower rate and the various borrower statuses. Therefore, the majority of the visualizations I created included at least one categorical variable or more. I spent a lot of time researching how to create visualization with one, two, or more categorical variables. The solution is to use boxplots, grouped bar charts, jitter plots, and heat maps for the visualizations.

The result of this analysis shows that Prosper rating and term are two major indicators of the borrower rate. Other borrower statuses also have effects on borrower rate but their effects are either small or are also factors of Prosper rating. I think this analysis would be a good reference for anyone who wants to borrower money from a p2p lending platform. 